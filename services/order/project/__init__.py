# services/order/project/__init__.py
import os
from flask import Flask
from flask_sqlalchemy import SQLAlchemy
from flask_cors import CORS
from project.api.routes import Cash_routes
from project.api.routes.check_routes import check_bp
from project.api.routes.credit_routes import credit_bp
from project.api.routes.customer_routes import customer_bp
from project.api.routes.item_routes import item_bp
from project.api.routes.order_routes import order_bp
from project.api.routes.orderdetail_routes import orderDetail_bp
from project.api.routes.orderstatus_routes import orderStatus_bp
from project.api.routes.payment_routes import payment_bp
from project.api.routes.wiretransfer_routes import wireTransfer_bp


# instantiate the db
db = SQLAlchemy()

def create_app(script_info=None):
    # instantiate the app
    app = Flask(__name__)

    #Pour appliquer le cors sur l'appllication
    CORS(app)

    # set config
    app_settings = os.getenv('APP_SETTINGS')
    app.config.from_object(app_settings)

    # set up extensions
    db.init_app(app)
    
    # register blueprints
    # #-----------------------------------------------------------------------------------------------------------
    # #====================================================== Cash ===============================================
    # #-----------------------------------------------------------------------------------------------------------

    app.register_blueprint(Cash_routes.cash_bp)


    # #-----------------------------------------------------------------------------------------------------------
    # #====================================================== Check ==============================================
    # #-----------------------------------------------------------------------------------------------------------

    app.register_blueprint(check_bp)


    # #-----------------------------------------------------------------------------------------------------------
    # #====================================================== Credit =============================================
    # #-----------------------------------------------------------------------------------------------------------

    app.register_blueprint(credit_bp)


    #-------------------------------------------------------------------------------------------------------------
    #====================================================== Customer =============================================
    #-------------------------------------------------------------------------------------------------------------

    # enregistrement des Blueprints
    app.register_blueprint(customer_bp)

    # #-----------------------------------------------------------------------------------------------------------
    # #====================================================== Item ===============================================
    # #-----------------------------------------------------------------------------------------------------------

    app.register_blueprint(item_bp)


    # #-----------------------------------------------------------------------------------------------------------
    # #====================================================== Order ==============================================
    # #-----------------------------------------------------------------------------------------------------------

    app.register_blueprint(order_bp)


    # #-----------------------------------------------------------------------------------------------------------
    # #====================================================== Order detail========================================
    # #-----------------------------------------------------------------------------------------------------------

    app.register_blueprint(orderDetail_bp)


    # #-----------------------------------------------------------------------------------------------------------
    # #======================================================Order Status=========================================
    # #-----------------------------------------------------------------------------------------------------------

    app.register_blueprint(orderStatus_bp)


    # #-----------------------------------------------------------------------------------------------------------
    # #====================================================== Payment ============================================
    # #-----------------------------------------------------------------------------------------------------------

    app.register_blueprint(payment_bp)


    # #-----------------------------------------------------------------------------------------------------------
    # #====================================================== Wire Transfert =====================================
    # #-----------------------------------------------------------------------------------------------------------

    app.register_blueprint(wireTransfer_bp)

    
    # shell context for flask cli
    app.shell_context_processor({'app': app, 'db': db})
    return app